<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>WebGL Load Test</title>
  <style>
    html,body{margin:0;height:100%;background:#111;}
    #gl{position:absolute;inset:0;width:100%;height:100%;}
    #hud{
      position:fixed;left:12px;top:12px;right:12px;
      padding:10px 12px;border-radius:12px;
      background:rgba(0,0,0,0.55);
      color:#fff;font:600 16px -apple-system,system-ui;
      z-index:10;
      white-space:pre-line;
    }
  </style>
</head>
<body>
  <div id="hud">Loading…</div>
  <canvas id="gl"></canvas>

<script>
(() => {
  const hud = document.getElementById("hud");
  const canvas = document.getElementById("gl");

  function say(msg){ hud.textContent = msg; }

  // 1) 전역 에러를 화면에 표시
  window.addEventListener("error", (e) => {
    say("ERROR ❌\n" + (e.message || "unknown error"));
  });
  window.addEventListener("unhandledrejection", (e) => {
    say("PROMISE ERROR ❌\n" + (e.reason?.message || String(e.reason)));
  });

  // 2) 캔버스 크기/배경 확실히 보이게
  function resize(){
    const dpr = window.devicePixelRatio || 1;
    canvas.width  = Math.max(1, Math.floor(innerWidth  * dpr));
    canvas.height = Math.max(1, Math.floor(innerHeight * dpr));
  }
  addEventListener("resize", resize);
  resize();

  // 3) WebGL 컨텍스트 획득 여부 표시
  const gl = canvas.getContext("webgl", {alpha:false, antialias:false});
  if(!gl){
    say("LOADED ✅\n하지만 WebGL 컨텍스트를 만들지 못했어요.\n(iOS 설정/콘텐츠 차단/저전력 모드 등 확인)");
    return;
  }

  // 4) 아주 단순한 “움직이는 화면” 만들기: clearColor가 계속 변하면 로딩 OK
  let t0 = performance.now();
  function loop(now){
    const t = (now - t0) / 1000;

    // 배경색이 계속 변하면 “실행 중”이 눈으로 확인됨
    const r = 0.2 + 0.2*Math.sin(t*1.3);
    const g = 0.2 + 0.2*Math.sin(t*1.7 + 1.0);
    const b = 0.2 + 0.2*Math.sin(t*2.1 + 2.0);

    gl.viewport(0,0,canvas.width,canvas.height);
    gl.clearColor(r,g,b,1);
    gl.clear(gl.COLOR_BUFFER_BIT);

    // HUD도 계속 갱신(프레임이 돌고 있음을 확인)
    say("LOADED ✅ WebGL OK\n" +
        `canvas: ${canvas.width}×${canvas.height}\n` +
        `time: ${t.toFixed(2)}s`);

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
